マルウェア動作検証およびシグネチャ作成
=============

環境構築手順
-------

### 手順1

PCを３台（もしくは４台）とIPSと有線ケーブルを３本（もしくは４本)用意する。

### 手順2

PCの役割を決める。今回は以下のとおりに設定した。
①アナリストチーム検証用(PW:abc123)：ルーター用
②アナリストチーム検証機 #1(PW:abc123)：VM上でマルウェアを感染させる用のPC
③Monitoring機器(PW:soc123!)；Security Alertログを見たり、User Definedを作成したりするためのPC
(④ID:Honey Potter PW:abc123：実機でマルウェアを感染させる用のPC)

### 手順3

IPSに有線ケーブルを繋ぐ。以下を参照にして繋いでください。
①→"PROTECTED"
②→"PROTECTED"
③→"MANAGEMENT"

### 手順4

IPSとPCを起動させる。

### 手順5

①のPCを設定する。
	1.モバイルルーターを接続させる。
	2.ネットワークの設定をする。

### 手順6

②のPCを設定する。
	1.VM上と共有するためのフォルダーとローカルに保存するためのフォルダーを作成する。
	2.VM VirtualBoxを起動して共有できるよう設定する。以下設定方法。
		自分が起動したいものをクリック→[設定]をクリック→[共有フォルダー]をクリック→フォルダーリスト内の共有フォルダを右クリック
		→[共有フォルダーを追加]→パス名を入力し自動マウントにチェック→出来上がり
	3.マルウェアに感染しても綺麗な状態にすぐ戻せるようスナップ写真を作成しておく。以下作成方法。
		[最新の状態]を選択→カメラアイコンをクリック→出来上がり
	4.起動してtestアカウント(PW:abc123)でログインして検証を始める。
	
### 手順7

③のPCを設定する。
	1.https://192.168.50.100に接続する。(今回はFirefoxで)
	2.ID:admin PW:abc123で認証する。
	3.接続する、ブロックしないと選択していけばモニタリングできる。

検証手順
-------

### 手順1

VirusTotal(https://www.virustotal.com/ja/)にログインして、欲しいマルウェアをダウンロードする。
	※今回は水谷さんのアカウントを拝借させていただきました。ちなみにこの中でログインできるのIBM社員のみ。

### 手順2

ダウンロードしたファイル共有フォルダーとローカルに保存するためのフォルダーにコピーする。

### 手順3

VM VirtualBoxのスナップショットを起動する。

### 手順4

共有フォルダーを開きマルウェアのファイルをデスクトップに移す。

### 手順5

デスクトップに置いたマルウェアのファイル名を変更する。
	※名前は何でもいいが拡張子は必ず「.exe」にする。
	
### 手順6

Wiresharkを起動してちゃんと動いているかを確認してからマルウェアを動かす。

### 手順7

Wiresharkのログデータを共有フォルダーに保存しローカルで見ることができるか確認する。

### 手順8

確認できたらVM上のWindowsをシャットダウンして、スナップショットを復元する。
	※必ず「現在のマシンの状態のスナップショットを作成」のチェックボックスからチェックをはずす。

連続して検証する際はこれを繰り返す。


記録方法
---------

- `report/(ハッシュ値).md` のファイルを作成し検証に関するまとめを記述してください
- `report/(ハッシュ値).pcap` のファイル名で通信データの記録を保存してください

例)

- `report/15c926d2602f65be0de65fa9c06aa6c6.md`
- `pcap/15c926d2602f65be0de65fa9c06aa6c6.pcap`
